# Output.c 文档

## 概述

`output.c` 文件包含4×4摩天大楼谜题求解器的网格显示功能。本模块负责格式化并将已解决的谜题网格以符合42学校标准的正确格式打印到标准输出。

## 文件目的

本模块处理：
- **网格格式化** - 将数字网格转换为可读输出
- **标准输出** - 只使用允许的函数（`write`）
- **间距控制** - 数字间的适当格式化间距
- **行管理** - 网格行的正确换行放置
- **42合规性** - 遵循严格的输出要求

## 设计理念

### 关注点分离
- **单一职责**：只处理输出格式化
- **无计算**：没有逻辑的纯显示函数
- **清洁接口**：简单的函数签名
- **最小依赖**：只使用基本实用函数

### 42学校要求
- **只允许函数**：通过实用包装器使用`write`
- **无printf/scanf**：自定义数字打印实现
- **精确格式**：匹配预期输出规范
- **错误处理**：只对有效解决方案进行清洁输出

---

## 函数文档

### `ft_print_grid`

```c
void ft_print_grid(t_grid *grid)
```

**目的**：将完成的4×4摩天大楼谜题解决方案打印到标准输出。

**参数**：
- `t_grid *grid` - 指向包含4×4解决方案的已解决网格结构的指针

**返回值**：
- `void` - 无返回值（纯输出函数）

**前置条件**：
- 网格必须完全填充（无零）
- 网格必须包含有效数字（1-4）
- 网格必须是有效解决方案（调用者责任）

**后置条件**：
- 网格被打印到stdout
- 输出遵循精确格式规范
- 光标位于输出后下一行的开始

---

## 算法分析

### 逐步逻辑

#### 1. **外循环 - 行迭代**
```c
i = 0;
while (i < SIZE)  // SIZE = 4
```
- **目的**：遍历4×4网格的每一行
- **范围**：i = 0, 1, 2, 3（代表从上到下的行）
- **控制**：使用while循环符合42规范

#### 2. **内循环 - 列迭代**  
```c
j = 0;
while (j < SIZE)  // SIZE = 4
```
- **目的**：处理当前行内的每个单元格
- **范围**：j = 0, 1, 2, 3（代表从左到右的列）
- **嵌套结构**：每行迭代执行4次

#### 3. **数字输出**
```c
ft_putnbr(grid->cells[i][j]);
```
- **函数调用**：使用实用函数进行数字打印
- **数据访问**：`grid->cells[i][j]`检索单元格值
- **有效范围**：数字1-4（谜题约束）
- **实现**：使用`write()`递归逐位输出

#### 4. **间距逻辑**
```c
if (j < SIZE - 1)
    ft_putchar(' ');
```
- **条件**：在数字后添加空格，除了行中的最后一个
- **逻辑**：`j < 3`意味着位置0,1,2得到空格，位置3不得到
- **结果**："1 2 3 4"格式（空格分隔，无尾随空格）

#### 5. **行终止**
```c
ft_putchar('\n');
i++;
```
- **换行**：每行以换行符结束
- **行推进**：移到外循环的下一行
- **输出结果**：每行在单独的行上

### 可视流程图
```
开始
  ↓
i = 0（行0）──────┐
  ↓                │
j = 0,1,2,3        │ 重复
打印: "1 2 3 4\n"  │ i = 1,2,3
  ↓                │
i = 1（行1）──────┘
  ↓
...继续...
  ↓
结束（打印了4行）
```

---

## 输出格式规范

### 预期输出格式
```
1 2 3 4
4 1 2 3
3 4 1 2
2 3 4 1
```

### 格式要求
- **数字**：只有单数字1-4
- **分隔符**：同一行数字间单空格
- **无尾随空格**：行中最后一个数字后立即跟换行符
- **行结束**：Unix风格换行符（`\n`）
- **无额外行**：恰好4行输出，无空白行

### 逐字符分析
```
位置: 0123456789...
输出:   "1 2 3 4\n4 1 2 3\n3 4 1 2\n2 3 4 1\n"
          └─────┘ └─────┘ └─────┘ └─────┘
           行0     行1     行2     行3
```

---

## 与项目的集成

### 调用层次
```
main()
├── ft_solve_skyscraper() → 成功
├── ft_print_grid() ← 在此调用
└── 返回0
```

### 使用上下文
- **何时调用**：只在成功谜题解决后
- **调用者**：求解器返回成功后的`main()`函数
- **前置条件**：网格包含有效完整解决方案
- **替代方案**：出错/失败时，改为打印"Error\n"

### 依赖函数
函数依赖于`utils.c`中的实用函数：
- `ft_putnbr(int n)` - 将整数转换为字符输出
- `ft_putchar(char c)` - 使用`write()`输出单个字符

---

## 内存和性能

### 内存使用
- **栈空间**：O(1) - 只有局部变量`i`，`j`
- **无分配**：无malloc/free操作
- **网格访问**：只读访问现有网格结构
- **无复制**：直接访问原始数据

### 时间复杂度
- **O(n²)**：其中n=4，所以O(16)常数时间
- **输出线性**：与打印字符数成比例
- **无需优化**：对于固定4×4大小已经最优

### 空间复杂度
- **O(1)**：循环变量的常数空间
- **无递归**：只有迭代实现
- **无缓冲区**：直接逐字符输出

---

## 错误处理和边界情况

### 输入验证
- **假设有效网格**：无空指针检查（调用者责任）
- **假设完整解决方案**：无零检查（求解器保证）
- **假设正确值**：无范围验证（求解器约束）

### 健壮设计选择
- **简单循环**：while循环不易出现off-by-one错误
- **清晰条件**：`j < SIZE - 1`明确且可读
- **无复杂逻辑**：最小分支减少错误潜力

### 错误场景（由调用者处理）
- **无效网格**：main()打印"Error\n"而不调用此函数
- **无解谜题**：求解器失败，此函数从不被调用
- **无效输入**：解析器失败，此函数从不被调用

---

## 42规范合规性

### 函数标准
✅ **函数长度**：18行（远低于25行限制）  
✅ **函数命名**：使用`ft_`前缀约定  
✅ **参数命名**：清晰、描述性参数名  
✅ **变量命名**：简单、清晰的`i`，`j`循环索引  
✅ **单函数**：文件中只有一个函数（低于5函数限制）

### 代码样式
✅ **缩进**：正确制表符缩进  
✅ **间距**：运算符和关键字周围正确间距  
✅ **大括号**：K&R大括号样式  
✅ **行长度**：所有行低于80字符  
✅ **无禁用函数**：只通过包装器间接使用允许的`write`

### 允许函数使用
- **write()**：通过`ft_putchar`和`ft_putnbr`间接使用
- **无printf**：自定义数字打印实现
- **无库函数**：纯自定义实现
- **42合规**：遵循所有学校限制

---

## 测试和验证

### 手动测试
```c
// 示例测试网格
t_grid test_grid = {
    .cells = {
        {1, 2, 3, 4},
        {4, 1, 2, 3}, 
        {3, 4, 1, 2},
        {2, 3, 4, 1}
    }
};

ft_print_grid(&test_grid);
// 预期输出:
// 1 2 3 4
// 4 1 2 3  
// 3 4 1 2
// 2 3 4 1
```

### 边界情况测试
```c
// 最小值（全1 - 无效谜题但测试输出）
// 最大值（全4 - 无效谜题但测试输出）
// 混合值（有效解决方案）
```

### 输出验证
- **字符计数**：每行应该恰好7个字符（"1 2 3 4"）
- **行计数**：恰好4行输出
- **无额外空白**：无尾随空格或额外换行符
- **正确数字**：所有值在1-4范围内

---

## 使用示例

### 标准使用
```c
if (ft_solve_skyscraper(&input, &grid))
{
    ft_print_grid(&grid);  // 打印解决方案
    return (0);
}
else
{
    write(1, "Error\n", 6);  // 改为打印错误
    return (1);
}
```

### 集成模式
```c
// 完整main()流程
parse_input() → solve_puzzle() → ft_print_grid() → 成功
     ↓               ↓                             
   错误          错误       → write("Error\n") → 失败
```

---

## 未来考虑

### 可扩展性
- **网格大小**：可以推广为N×N网格
- **输出格式**：可以支持不同格式选项
- **错误输出**：可以移到此模块以保持一致性

### 优化
- **当前实现**：对于4×4固定大小已经最优
- **无过早优化**：优先选择简单、清晰代码
- **性能适当**：输出不是瓶颈

### 维护
- **单一职责**：如果需要，容易修改输出格式
- **清晰分离**：独立于求解逻辑
- **可测试**：用已知网格输入容易进行单元测试

此文档提供了对输出格式化逻辑及其在根据42学校要求交付正确格式化的摩天大楼谜题解决方案中的作用的完整理解。